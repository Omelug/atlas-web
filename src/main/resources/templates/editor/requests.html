<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Requests</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="robots" content="noindex,follow" />
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="/styly.css">
</head>
<body>
    <div>
        <br><span>Request:</span>
        <div class="container-fluid">
            <div class="row">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <!--<th>Request Mark</th>
                        <th>Parent Request Mark</th>
                        <th>Link</th>
                        <th>Local Visibility</th>-->
                        <th>Request Type</th>
                        <th>Request Status</th>
                        <th>Name</th>
                        <!--<th>Request Message</th>-->ad
                        <th>Create Date</th>
                        <th>Modify Date</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="request : ${requestList}" class="selectable-row">
                        <form id="selectRequest" th:action="@{/editor/selectRequest}" method="post">
                            <td th:text="${request.id}"></td>
                            <input type="hidden" name="requestMark" th:value="${request.requestMark}" />
                            <!--<td th:text="${request.requestMark}"></td>
                            <td th:text="${request.parentRequestMark}"></td>
                            <td th:text="${request.link}"></td>
                            <td th:text="${request.local_visibility}"></td>-->
                            <td th:text="${request.request_typ}"></td>
                            <td th:text="${request.request_status}"></td>
                            <td th:text="${request.name}"></td>
                            <!--<td th:text="${request.request_message}"></td>-->
                            <td th:text="${#dates.format(request.createDate, 'yyyy-MM-dd HH:mm:ss')}"></td>
                            <td th:text="${#dates.format(request.modifyDate, 'yyyy-MM-dd HH:mm:ss')}"></td>
                        </form>
                    </tr>
                    </tbody>
                </table>
                <script>
                    $(document).ready(function () {
                        $(".selectable-row").on("click", function (event) {
                            event.preventDefault();

                            var requestMark = $(this).find("input[name='requestMark']").val();
                            console.log("COZE "+ requestMark);
                            $.ajax({
                                type: "POST",
                                url: "/editor/selectRequest",
                                data: {
                                    requestMark: requestMark
                                },
                                success: function (data) {
                                    $("#selectedRequestDiv").html(data);
                                    //console.log("Data" + data);
                                },
                                error: function (xhr, textStatus, errorThrown) {
                                    console.error("Error select request:", textStatus, errorThrown);
                                },
                            });
                        });
                    });
                </script>
            </div>
            <div class="row">
                <div id="selectedRequestDiv"></div>
                <div th:replace="editor/selectedRequest"></div>
            </div>
        </div>

    </div>
</body>
</html>